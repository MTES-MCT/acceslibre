{% load a4a %}
{% load static %}

<div class="a4a-erp-details">
  <header class="a4a-erp-header row">
    <div class="col-sm-8">
      <h3>
        {{ erp.nom }}
        {% if erp.activite %}
        <small class="text-muted">{{ erp.activite.nom }}</small>
        {% endif %}
      </h3>
      <address class="m-0 p-0 mb-2"><em>{{ erp.adresse }}</em></address>
      <div>
        {% if erp.siret %}
          <span class="d-inline-block mr-2" title="Numéro SIRET de l'établissement">
            <i class="icon icon-commercial"></i> {{ erp.siret|format_siret }}
          </span>
        {% endif %}
        {% if erp.contact_email %}
          <a class="d-inline-block mr-2" href="mailto:{{ erp.contact_email }}" target="_blank">
            <i class="icon icon-mail"></i> Contacter cet ERP
          </a>
        {% endif %}
        {% if erp.site_internet %}
          <a class="d-inline-block mr-2" href="{{ erp.site_internet }}" target="_blank">
            <i class="icon icon-globe"></i> Site internet
          </a>
        {% endif %}
        {% if erp.telephone %}
          <a class="d-inline-block mr-2" href="tel:{{ erp.telephone }}">
            <i class="icon icon-phone"></i> {{ erp.telephone }}
          </a>
        {% endif %}
        {% if user.is_superuser %}
          <a class="d-inline-block mr-2" href="{% url "admin:erp_erp_change" object_id=erp.pk %}" target="_blank">
            <i class="icon icon-pencil"></i> Éditer dans l'admin
          </a>
        {% endif %}
      </div>
    </div>
    <div class="col-sm-4">
      <div class="a4a-accessibility-group d-flex justify-content-end align-center">
      {% for label in erp.accessibilite.labels.all %}
        {% if label.nom != "Aucun" and label.nom != "Autre" %}
        <div class="a4a-accessibility-label">
          <img class="a4a-accessibility-label-logo" src="{% static "img/labels" %}/{{ label.slug }}.jpg"
            alt="{{ label.nom }}" title="Cet établissement a obtenu le label {{ label.nom }}"
            aria-label="Cet établissement a obtenu le label {{ label.nom }}" />
          <div class="text-center">
            {% if "auditif" in erp.accessibilite.labels_familles_handicap %}
            <span title="Handicap auditif">
              <img class="a4a-handicap-icon" src="{% static "img/handicap/auditif.svg" %}" alt="Handicap auditif" />
            </span>
            {% endif %}
            {% if "mental" in erp.accessibilite.labels_familles_handicap %}
            <span title="Handicap mental">
              <img class="a4a-handicap-icon" src="{% static "img/handicap/mental.svg" %}" alt="Handicap mental"/>
            </span>
            {% endif %}
            {% if "moteur" in erp.accessibilite.labels_familles_handicap %}
            <span title="Handicap moteur">
              <img class="a4a-handicap-icon" src="{% static "img/handicap/moteur.svg" %}" alt="Handicap moteur" />
            </span>
            {% endif %}
            {% if "visuel" in erp.accessibilite.labels_familles_handicap %}
            <span title="Handicap visuel">
              <img class="a4a-handicap-icon" src="{% static "img/handicap/visuel.svg" %}" alt="Handicap visuel" />
            </span>
            {% endif %}
          </div>
        </div>
        {% endif %}
      {% endfor %}
      </div>
    </div>
  </header>

  {% if not accessibilite_data %}
    <div class="alert alert-info mb-3">
      Les données d'accessibilité pour cet établissement ne sont pas encore disponibles.
    </div>
    {% if not erp.user %}
      <p class="text-center">
        <a class="btn btn-primary" href="{% url "contrib_claim" erp_slug=erp.slug %}">
          Je souhaite renseigner les informations d'accessibilité pour cet établissement
        </a>
      </p>
    {% elif erp.user and erp.user.username != user.username %}
      <div class="alert alert-info">
        Si vous assurez la gestion de cet établissement et que vous souhaitez apporter des corrections
        aux informations mentionnées, merci de <a href="{% url "contact_form" %}">nous contacter</a>.
      </div>
    {% endif %}
  {% else %}
    <h4>Accessibilité</h4>

    <div class="row">
      <div class="col-md-4">
        <ul class="nav flex-column nav-pills a4a-nav-pills" role="tablist" aria-label="Sections">
        {% for section, info in accessibilite_data.items %}
          <li class="nav-item">
            <a class="nav-link text-nowrap {% if forloop.first %} active{% endif %}"
                href="#{{ info.tabid }}"
                title="{{ info.description }}"
                role="tab"
                aria-controls="{{ info.tabid }}"
                aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
                id="{{ info.tabid }}-tab"
                data-toggle="tab">
              <i class="icon icon-{{ info.icon }} mr-2"></i>{{ section }}
            </a>
          </li>
        {% endfor %}
        </ul>
      </div>
      <div class="col-md-8 tab-content">
      {% for section, info in accessibilite_data.items %}
        <div class="tab-pane{% if forloop.first %} active{% endif %}" id="{{ info.tabid }}"
            role="tabpanel" aria-labelledby="{{ info.tabid }}-tab">
          {% if info.fields %}
            {% include "erps/commune/fields.html" with fields=info.fields %}
          {% elif info.sections %}
            {% for subsection, subinfo in info.sections.items %}
              <div class="card mb-3">
                <div class="card-header border-bottom-0 p-2">
                  <h6 class="m-0">
                    <i class="icon icon-{{ subinfo.icon }} mr-2"></i>{{ subsection }}
                  </h6>
                </div>
                <div class="card-body p-0">
                  {% include "erps/commune/fields.html" with fields=subinfo.fields %}
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      {% endfor %}
      </div>
    </div>
  {% endif %}
</div>
