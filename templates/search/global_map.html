{% extends "editorial/base.html" %}

{% load a4a %}
{% load static %}
{% load i18n %}

{% block page_title %}{% spaceless %}
  {% if pager %}
    {% translate "Résultats pour" %} {{ what|default_if_none:"" }} {{ where|default_if_none:"" }}, {% translate "page" %} {{ pager.number }}/{{ paginator.num_pages }}
  {% else %}
  {% translate "Aucun résultat" %}
  {% endif %}
{% endspaceless %}{% endblock %}
{% block top_fluid_content %}{% endblock %}

{% block header %}
  {% include "editorial/header.html" with dark=True %}
{% endblock %}

{% block editorial_content %}
  <h1 class="mt-3 mb-2">
    <span class="sr-only">{% translate "Localité :" %}</span> {{ where }}
    {% if where and what %}<small class="text-muted">/</small>{% endif %}
    {% if what %}<span class="sr-only">{% translate "Activité :" %}</span> {{ what }}{% endif %}
  </h1>

  <section class="pt-2" id="results">
    {% if paginator.count == 0 %}
    <div class="alert alert-info" role="alert" aria-live="assertive">
      <i aria-hidden="true" class="icon icon-warning"></i>
      {% translate "Il n'y a pas de résultat correspondant à votre recherche" %} <strong>{{ what }} {{ where }}</strong>.
    </div>
    <div class="alert" role="alert" aria-live="assertive">
      <p>
        <i aria-hidden="true" class="icon icon-bulb"></i>
        {% translate "Vous pouvez cependant :"%}
      </p>
      <ul>
        {% if commune %}
        <li><a href="{% url 'search' %}?where={{ commune }}&code={{ commune.code_insee }}">{% translate "Afficher la liste de tous les établissements situés à {{ commune }}" %}</a></li>
        <li><a href="{% url 'search' %}?where={{ commune.nom }}&lat={{ commune.geom.y }}&lon={{ commune.geom.x }}">{% translate "Afficher les établissements situés dans un rayon de {{ MAP_SEARCH_RADIUS_KM }} kilomètres autour de" %} {{ commune|preposition_nom }}</a></li>
        {% endif %}
        <li><a href="{% url 'contrib_start' %}{% if commune %}?code_insee={{ commune.code_insee }}{% endif %}">{% if commune %}{% translate "Ajouter un établissement manquant à {{ commune }}" %}{% else %}{% translate "Ajouter un établissement manquant" %}{% endif %}</a></li>
        <li><a href="{% url 'contact_form' %}">{% translate "Nous contacter pour obtenir de l'aide ou nous signaler un problème" %}</a></li>
      </ul>
    </div>
    {% elif pager %}
    <div class="row mt-2">
      <div class="col-sm-6">
        <h2 class="h4 m-0 mb-3">
          {{ paginator.count }} {% translate "établissement" %}{{ paginator.count|pluralize:"s" }}
          {% if where|startswith:"Autour de moi" or where|startswith:"Around me" %}
            {% translate "à moins de {{ MAP_SEARCH_RADIUS_KM }}" %}<span aria-hidden="true">{% translate "km" %}</span> <span class="sr-only">{% translate "kilomètres" %}</span>
          {% endif %}
          <small class="text-muted">{% if paginator.num_pages > 1 %}{% translate "page" %} {{ pager.number }}/{{ paginator.num_pages }}{% endif %}</small>
        </h2>
      </div>
    </div>
    <div id="qrcode" class="row">
      <div class="col-12 text-sm-right text-center mb-2 mt-0">
        <span class="h6 font-weight-bold w-100 mb-0 pt-3">{% translate "Retrouvez l'ensemble de ces établissements via ce QRCode" %}</span>
        <img height="100" src="data:image/png;base64,{{ qrcode_img }}">
      </div>
    </div>
    <div class="flex">
      <span class="ml-auto mt-2">
        <i aria-hidden="true" class="icon icon-zoom-in"></i>
        <a href="" id="map-height-toggle-link">{% translate "Agrandir la carte" %}</a>
      </span>
    </div>
    <div class="mb-4 mt-2 order-1">
        {% include "common/map.html" with map_classes="a4a-app-erp-map rounded shadow-sm" %}
    </div>
    {% endif %}
  </section>
{% endblock %}
