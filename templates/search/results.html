{% extends "editorial/base.html" %}
{% load a4a %}
{% load static %}
{% load waffle_tags %}
{% load i18n %}
{% block page_title %}
    {% spaceless %}
        {% if pager %}
            {% translate "Résultats pour" %} {{ what|default_if_none:"" }} {{ where|default_if_none:"" }}, {% translate "page" %} {{ pager.number }}/{{ paginator.num_pages }}
        {% else %}
            {% translate "Aucun résultat" %}
        {% endif %}
    {% endspaceless %}
{% endblock page_title %}
{% block top_fluid_content %}
    {% include "search/includes/filter_modal.html" with dark=False %}
{% endblock top_fluid_content %}
{% block full_editorial_content %}
    <section id="results">
        <div class="main-search position--relative {% if not display_filters %}filters-removed{% endif %}">
            <div class="main-search__main-filters">
                {% include "search/includes/main_filters.html" %}
                {% flag "EXPORT_RESULTS" %}
                {% if request.user.is_authenticated %}
                    <div id="export-results">
                        <form method="get" action="{% url 'export' %}">
                            {% for key, value in request.GET.items %}<input type="hidden" name="{{ key }}" value="{{ value }}">{% endfor %}
                            <button type="submit"
                                    class="fr-btn fr-btn--tertiary-no-outline"
                                    id="export-results-btn">
                                {% translate "Exporter les résultats au format CSV" %}
                            </button>
                        </form>
                    </div>
                {% endif %}
            {% endflag %}
        </div>
        <div class="fr-tabs">
            <ul class="fr-tabs__list"
                role="tablist"
                aria-label="Résultats de recherche">
                <li role="presentation">
                    <button id="tabpanel-1"
                            class="fr-tabs__tab fr-tabs__tab--icon-left"
                            tabindex="0"
                            role="tab"
                            aria-selected="true"
                            aria-controls="tabpanel-1-panel">{% translate "Liste des résultats" %}</button>
                </li>
                <li role="presentation">
                    <button id="tabpanel-2"
                            class="fr-tabs__tab fr-tabs__tab--icon-left"
                            tabindex="-1"
                            role="tab"
                            aria-selected="false"
                            aria-controls="tabpanel-2-panel">{% translate "Carte" %}</button>
                </li>
            </ul>
            <div id="tabpanel-1-panel"
                 class="fr-tabs__panel fr-tabs__panel--selected fr-col fr-col-12 fr-p-0"
                 role="tabpanel"
                 aria-labelledby="tabpanel-1"
                 tabindex="0">
                <div class="main-search__list" id="erp-results-list">
                    <div class="position--sticky">
                        <h2 class="fr-h4 fr-mb-1w">{% translate "Établissements existants sur Acceslibre" %}</h2>
                        <p id="number-of-results" class="fr-mb-0 fr-text--xl" aria-live="polite">
                            {% translate "En cours de chargement..." %}
                        </p>
                    </div>
                    <section class="overflow-y-scroll">
                        <ul id="search-results"
                            class="p-0 gap-1w display--flex direction--column">
                        </ul>
                        <div class="fr-btns-group fr-m-0">
                            <button id="view-more-erps-btn" class="fr-btn fr-hidden fr-m-auto">{% translate "Voir plus" %}</button>
                        </div>
                        <p id="view-more-erps-loading" class="fr-hidden text--center fr-mt-1w">{% translate "En cours de chargement..." %}</p>
                    </section>
                </div>
            </div>
            <div id="tabpanel-2-panel"
                 class="fr-tabs__panel fr-col fr-col-12 a4a-search-map-area {% if commune is not None %}fr-tabs__panel--without-search{% endif %}"
                 role="tabpanel"
                 aria-labelledby="tabpanel-2"
                 tabindex="0">
                <div class="main-search__map">{% include "common/map.html" with map_classes="a4a-search-map rounded" %}</div>
            </div>
        </div>
    </div>
</section>
{% endblock full_editorial_content %}
