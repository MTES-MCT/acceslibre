{% extends "editorial/base.html" %}

{% load static %}
{% load i18n %}

{% block page_title %}API acceslibre{% endblock %}

{% block stylesheet_extras %}
<link rel="stylesheet" type="text/css" href="//unpkg.com/swagger-ui-dist@3/swagger-ui.css" />
<style>
  .swagger-ui .wrapper {
    padding: 0;
  }

  .swagger-ui .opblock-description-wrapper,
  .swagger-ui .opblock-external-docs-wrapper,
  .swagger-ui .opblock-title_normal {
    font-size: 14px;
  }

</style>
{% endblock %}

{% block editorial_content %}
<h1>{% translate "API acceslibre" %}</h1>
{% if request.session.api_key %}
{% translate "Réinitialiser la clef API : " %}
<form action="{% url 'set_api_key' %}" method="post">
  <input type="hidden" name="api_key" value="" />
  <input type="submit" value="{% translate 'OK' %}" />
  {% csrf_token %}
</form>
<div id="swagger-ui"></div>
<script src="//unpkg.com/swagger-ui-dist@3/swagger-ui-bundle.js"></script>
<script>
  const ui = SwaggerUIBundle({
    url: "{% url schema_url %}",
    dom_id: "#swagger-ui",
    presets: [
      SwaggerUIBundle.presets.apis,
      SwaggerUIBundle.SwaggerUIStandalonePreset
    ],
    layout: "BaseLayout",
    display: {
      tryItOutEnabled: false,
    },
    requestInterceptor: request => {
      request.headers["X-CSRFToken"] = "{{ csrf_token }}";
      request.headers['Authorization'] = "Api-Key {{ request.session.api_key }}"
      return request;
    }
  });
</script>
{% else %}

<p>
  {% translate "Pour accéder à l'API, veuillez fournir une clef API valide :" %}
</p>

<form action="{% url 'set_api_key' %}" method="post">
  <input type="text" name="api_key" />
  <input type="submit" value="{% translate 'OK' %}" />
  {% csrf_token %}
</form>

<p class="pt-5">
  {% blocktranslate %}
  Si vous n'avez pas encore de clef API, <a href="{{settings.SITE_ROOT_URL}}/contact/api_key">contactez-nous</a>, nous
  n'avons, à priori, pas de raison de refuser :-)
  {% endblocktranslate %}
</p>

{% endif %}
{% endblock %}
