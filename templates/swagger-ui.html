{% extends "editorial/base.html" %}
{% load static %}
{% load i18n %}
{% block page_title %}
    API acceslibre
{% endblock page_title %}
{% block stylesheet_extras %}
    <link rel="stylesheet"
          type="text/css"
          href="//unpkg.com/swagger-ui-dist@3/swagger-ui.css" />
    <style>
  .swagger-ui .wrapper {
    padding: 0;
  }

  .swagger-ui .opblock-description-wrapper,
  .swagger-ui .opblock-external-docs-wrapper,
  .swagger-ui .opblock-title_normal {
    font-size: 14px;
  }

    </style>
{% endblock stylesheet_extras %}
{% block editorial_content %}
    <h1>{% translate "API acceslibre" %}</h1>
    {% if request.session.api_key %}
        {% translate "Réinitialiser la clef API : " %}
        <form action="{% url 'set_api_key' %}" method="post">
            <input type="hidden" name="api_key" value="" />
            <input type="submit" value='{% translate "OK" %}' />
            {% csrf_token %}
        </form>
        <div id="swagger-ui"></div>
        <script src="//unpkg.com/swagger-ui-dist@3/swagger-ui-bundle.js"></script>
        <script>
  const ui = SwaggerUIBundle({
    url: "{% url schema_url %}",
    dom_id: "#swagger-ui",
    presets: [
      SwaggerUIBundle.presets.apis,
      SwaggerUIBundle.SwaggerUIStandalonePreset
    ],
    layout: "BaseLayout",
    display: {
      tryItOutEnabled: false,
    },
    requestInterceptor: request => {
      request.headers["X-CSRFToken"] = "{{ csrf_token }}";
      request.headers['Authorization'] = "Api-Key {{ request.session.api_key }}"
      return request;
    }
  });
        </script>
    {% else %}
        <form action="{% url 'set_api_key' %}" method="post">
            <label class="fr-label" for="api_key">
                {% translate "Pour accéder à l'API, veuillez fournir une clef API valide :" %}
            </label>
            <input class="fr-input" type="text" name="api_key" id="api_key" />
            <input type="submit" value='{% translate "OK" %}' />
            {% csrf_token %}
        </form>
        <p class="pt-5">
            {% blocktranslate %}
  Si vous n'avez pas encore de clef API, <a href="{{settings.SITE_ROOT_URL}}/contact/api_key">contactez-nous</a>, nous
  n'avons, à priori, pas de raison de refuser :-)
  {% endblocktranslate %}
        </p>
    {% endif %}
{% endblock editorial_content %}
