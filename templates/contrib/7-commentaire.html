{% extends "contrib/base_access_form.html" %}

{% load a4a %}
{% load crispy_forms_tags %}
{% load i18n %}

{% block page_title %}{% translate "Commentaire et informations complémentaires" %}{% endblock %}
{% block full_infos %}{% endblock %}
{% block contrib_title %}{% translate "{{ erp.nom }} de {{ erp.commune_ext }}" %}{% endblock %}
{% block contrib_step %}<small>{% translate "Étape 7 sur 7" %}</small>{% endblock %}
{% block contrib_subtitle %}{% translate "Informations d'accessibilité" %}{% endblock %}
{% block robots %}noindex, nofollow{% endblock %}

{% block fields_content %}
<h3 class="h4">{% translate "Informations complémentaires" %}</h3>

{% include "fields/boolradio.html" with field=form.labels inline=True %}
{% include "fields/textarea.html" with field=form.labels_autre %}
{% include "fields/boolradio.html" with field=form.labels_familles_handicap inline=True %}
<script>
  $(document).ready(function () {
    const $fieldFamilles = $(".field-labels_familles_handicap");
    $fieldFamilles.hide();

    const $fieldAutre = $(".field-labels_autre")
    $fieldAutre.hide();

    const $labelsInputs = $("ul#id_labels input[type=checkbox]");

    function getCheckedLabels() {
      return $labelsInputs.get().reduce(function (acc, input) {
        if (input.checked) {
          acc.push(input.value)
        }
        return acc;
      }, []);
    }

    function checkDisplay() {
      const checkedLabels = getCheckedLabels();
      if (!(checkedLabels.indexOf("autre") == -1 || checkedLabels.indexOf("other") == -1)) {
        $fieldAutre.show();
        $fieldAutre.find("input[type=text]").attr("required", "required");
      } else {
        $fieldAutre.hide();
        $fieldAutre.find("input[type=text]").val("");
        $fieldAutre.find("input[type=text]").removeAttr("required");
      }
      if (checkedLabels.length > 0) {
        $fieldFamilles.show();
      } else {
        $fieldFamilles.hide();
        $fieldFamilles.find("input[type=checkbox]").each(function (i, input) {
          input.checked = false;
        });
      }
    }

    $labelsInputs.each(function (i, input) {
      $(input).on("change", checkDisplay);
    });

    checkDisplay();
  });
</script>
{{ form.commentaire|as_crispy_field }}
{% endblock %}
