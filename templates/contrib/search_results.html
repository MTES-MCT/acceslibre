{% load a4a %}

<h2 class="h3 mb-3">Sélectionner un établissement</h2>

<div class="alert alert-info">
  <p>
    <i aria-hidden="true" class="icon icon-info-circled"></i>
    Si l'établissement recherché ne figure pas dans cette liste, vous pouvez&nbsp;:
  </p>
  <ul class="mb-0">
    <li><a href="{% url "contrib_start" %}">Effectuer une nouvelle recherche</a></li>
    <li><a href="{% url "contrib_admin_infos" %}">Saisir les informations de l'établissement manuellement</a></li>
  </ul>
</div>

{% for result in results %}
<div class="card mb-3">
  <div class="row no-gutters">
    <div class="col-md-5 a4a-result-map"{% if result.coordonnees %} style="min-height:100px;background-image: url('{% result_map_img result.coordonnees %}')"{% endif %}>
    </div>
    <div class="col-md-7">
      <div class="card-body">
        <h3 class="h6 card-title font-weight-bold">
          {% if result.exists and result.exists.is_online %}
          <a href="{{ result.exists.get_absolute_url }}" target="_blank">{{ result.nom }}</a>
          {% else %}
          {{ result.nom }}
          {% endif %}
          {% if result.exists %}
          <span class="badge badge-danger">Existe dans la base</span>
          {% elif result.actif %}
          <span class="badge badge-success">En activité</span>
          {% else %}
          <span class="badge badge-warning">Fermé</span>
          {% endif %}
        </h3>
        <p class="card-text">
          <small>
            {% if result.siret %}SIRET: {{ result.siret }}<br>{% endif %}
            {% if result.naf %}{{ result.naf }}: {{ result.naf|get_naf_label }}<br>{% endif %}
            {{ result.numero|default_if_none:"" }} {{ result.voie|default_if_none:"" }}<br>
            {% if result.lieu_dit %}{{ result.lieu_dit|default_if_none:"" }}<br>{% endif %}
            {{ result.code_postal|default_if_none:"" }} {{ result.commune|default_if_none:"" }}
          </small>
        </p>
        <p class="card-text mb-0">
          <a class="btn btn-primary btn-block {% if not result.actif or result.exists %}disabled{% endif%}"
            href="{% url "contrib_admin_infos" %}?data={{ result|encode_provider_data }}"
            {% if not result.actif or result.exists %}disabled{% endif%}>
            Sélectionner cet établissement
          </a>
        </p>
      </div>
    </div>
  </div>
</div>
{% endfor %}

<p><a href="{% url "contrib_start" %}">&laquo; Retour à la page précédente</a></p>
