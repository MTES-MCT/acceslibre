{% extends "editorial/base.html" %}

{% load static %}

{% block page_title %}Statistiques{% endblock%}

{% block editorial_content %}
<main role="main" id="content">
  <h2 class="my-3">Statistiques</h2>

  <div class="card-deck my-4">
    <div class="card shadow-sm">
      <div class="card-body d-flex flex-column flex-md-row justify-content-center justify-content-md-start align-items-center">
        <h3 class="text-count font-weight-bold">{{ nb_published_erps }}</h3>
        <div class="h3 px-3 text-center text-md-left">
          établissement{{ nb_published_erps|pluralize:"s" }} publié{{ nb_published_erps|pluralize:"s" }}
          sur {{ SITE_NAME|title }} au {{ current_date|date:"j/m/Y" }} grâce à la contribution de <strong>tous</strong>
        </div>
      </div>
    </div>
  </div>

  <div class="card-group my-4">
    <div class="card shadow-sm">
      <div class="card-header text-truncate">
        Évolution du nombre d'établissements publiés
      </div>
      <div class="card-body p-2">
        <canvas id="erpCountChart" width="100%" height="250"></canvas>
        <script>
        var erpCountChart = new Chart("erpCountChart", {
          type: "bar",
          data: {
            labels: {{ erp_counts_histogram.labels|safe }},
            datasets: [
              {
                label: "Nombre d'établissements renseignés et publiés",
                data: {{ erp_counts_histogram.totals|escapejs }},
                backgroundColor: "#075ea2",
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false
          }
        });
        </script>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-header">Top contributeurs</div>
      <div class="card-body">
        <ol class="mb-0">
        {% for contributor in top_contributors %}
          <li>
            <strong>{{ contributor.username }}</strong>
            <small class="text-muted">
              {{ contributor.erp_count_published }}{% if contributor.erp_count_published != contributor.erp_count_total %}/{{ contributor.erp_count_total }}{% endif %}
              fiche{{ contributor.erp_count_published|pluralize:"s" }}
              publiée{{ contributor.erp_count_published|pluralize:"s" }}
            </small>
          </li>
        {% endfor %}
        </ol>
      </div>
    </div>
  </div>

  <div class="card-deck mt-3">
    <div class="card shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Principaux territoires couverts</span>
        <a href="{% url "stats_territoires" %}">Voir plus de territoires</a>
      </div>
      <div class="card-body">
        {% include "stats/includes/territoires_table.html" %}
      </div>
    </div>
  </div>

  <div class="mt-3">
    <h2 class="h5 my-3">Fréquentation <small class="text-muted">sur les 30 derniers jours</small></h2>
    <iframe width="100%" height="350" aria-label="Fréquentation du site"
      src="https://stats.data.gouv.fr/index.php?module=Widgetize&action=iframe&forceView=1&viewDataTable=graphEvolution&moduleToWidgetize=VisitsSummary&actionToWidgetize=getEvolutionGraph&idSite=118&period=day&date=yesterday&disableLink=1&widget=1"
      scrolling="yes" frameborder="0" marginheight="0" marginwidth="0"></iframe>
  </div>
</main>
{% endblock %}
